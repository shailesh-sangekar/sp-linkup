<!--Third Party-->
<script src="/SiteAssets/Files/angular.js"></script>

<!--Application-->
<script src="/SiteAssets/Files/spcrud.js"></script>
<link rel="stylesheet" href="/SiteAssets/ManageTicket/AllTicket.css"></link>
<script src="/SiteAssets/ManageTicket/AllTicket.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://rawgithub.com/eligrey/FileSaver.js/master/FileSaver.js" type="text/javascript"></script>

<div ng-app="AllTicketApp" class="appmodel">
    <div ng-controller="AllTicketCtl">
        <div class="spinner" ng-hide="spinnerloaded"></div>
        <span ng-hide="spinnerloaded">
				Loading.....
			</span>
        <div ng-cloak="" ng-show="spinnerloaded">
            <div class="row" ng-if="Authorised">
                <div class="col-md-12">
                    <h4 class="masterHeading">Manage Ticket</h4>
                <div>
                    <input type="text" ng-model="query" ng-change="search()"  placeholder="Search">
                </div>
                 <a href="#" id="test" class="btn btn-icon-only blue" style="width: 90px;border-radius: 3px!important;height: 31px;float: right;margin-top: -44px;" ng-click="fnExcelReport();">
                        <i class="fa fa-download" style="margin-left:0px;margin-top: 5px;"></i>
                        <span style="margin-left:-5px;">To Excel</span>
                    </a>

                

                    <div class="scrollTable" style="margin-top: 25px;">
                        <table id="myTable" class="table table-striped table-bordered table-hover table-checkable order-column">
                            <thead>
                                <tr>
                                    <th>Raised By</th>
                                    <th>Department</th>
                                    <th>Concern</th>
                                    <th>Status</th>
                                    <th>Priority</th>
                                    <th>Created</th>
                                    <th>Updated</th>
                                    <th>Updated By</th>
                                    <th>Resolved By</th>
                                    <th>Age Days</th>
                                    <!--<th>Approvers Comment</th>-->
                                    <th>View</th>
                                    <th>Reply</th>
                                    <th>Resolve</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in pagedItems[currentPage] ">
                                    <td>{{item.Employee.Title}}</td>
                                    <td>{{item.Department.Department}}</td>
                                    <td>{{item.Actual_x0020_Concern}}</td>
                                    <td>{{item.FinalStatus?item.FinalStatus:'N/A'}}</td>
                                    <td>{{item.Priority}}</td>
                                    <td><span ng-bind="item.Created | date:'dd/MM/yyyy'"></span></td>
                                    <td><span ng-bind="item.Modified | date:'dd/MM/yyyy'"></span></td>
                                    <td>{{item.Editor.Title}}</td>
                                    <td>{{item.ResolvedBy?item.ResolvedBy:'N/A'}}</td>
                                    <td>{{item.ageDiff}}</td>
                                    <!--<td>{{item.Approver_x0020_comment}}</td>-->
                                    <td><a href="" data-toggle="modal" data-target="#myModal" ng-click="View(item)">View</a></td>
                                    <td><a href="" data-toggle="modal" data-target="#myModal" ng-click="Reply(item)">Reply</a></td>
                                    <td><a href="" data-toggle="modal" data-target="#myModal" ng-click="Resolve(item)">Resolve</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!--<div class="row">-->
                    <div class="scrollpaging">
                        <!--<div class="col-md-12">-->
                        <table class="table">
                            <!--<thead>
                                <tr>
                                    <th></th>
                                    <th ng-repeat="n in range(pagedItems.length)"></th>
                                    <th></th>

                                </tr>
                            </thead>-->
                            <tbody>
                                <tr class="pagination pull-right">
                                    <td>Showing {{pagedItems[currentPage].length}}/{{DatalistESPLServiceDesk.length}}</td>
                                    <td ng-class="{disabled: currentPage == 0}">
                                        <a href ng-click="prevPage()">« Prev</a>
                                    </td>
                                    <td ng-repeat="n in range(pagedItems.length)" ng-class="{active: n == currentPage}" ng-click="setPage()">
                                        <a href ng-bind="n + 1">1</a>
                                    </td>
                                    <td ng-class="{disabled: currentPage == pagedItems.length - 1}">
                                        <a href ng-click="nextPage()">Next »</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <!--</div>
                        </div>-->
                    </div>
                    <div class="scrollTable" ng-show="ExportTable">
                        <table id="myTableToExport" class="table table-striped table-bordered table-hover table-checkable order-column">
                            <thead>
                                <tr>
                                    <th>Raised By</th>
                                    <th>Department</th>
                                    <th>Concern</th>
                                    <th>Status</th>
                                    <th>Priority</th>
                                    <th>Created</th>
                                    <th>Updated</th>
                                    <th>Updated By</th>
                                    <th>Resolved By</th>
                                    <th>Age Days</th>
                                    <!--<th>Approvers Comment</th>-->
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in DatalistESPLServiceDesk">
                                    <td>{{item.Employee.Title}}</td>
                                    <td>{{item.Department.Department}}</td>
                                    <td>{{item.Actual_x0020_Concern}}</td>
                                    <td>{{item.FinalStatus?item.FinalStatus:'N/A'}}</td>
                                    <td>{{item.Priority}}</td>
                                    <td><span ng-bind="item.Created | date:'dd/MM/yyyy'"></span></td>
                                    <td><span ng-bind="item.Modified | date:'dd/MM/yyyy'"></span></td>
                                    <td>{{item.Editor.Title}}</td>
                                    <td>{{item.ResolvedBy?item.ResolvedBy:'N/A'}}</td>
                                    <td>{{item.ageDiff}}</td>
                                    <!--<td>{{item.Approver_x0020_comment}}</td>-->
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>


                <div class="modal fade" id="myModal" role="dialog">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">View Ticket</h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <div class="col-sm-6">
                                        <label for="sel1">Select Department</label>
                                        <select class="form-control" id="sel1" disabled> 
                                     <option ng-model="mod">{{mod.Department.Department}}</option>                   
                                    </select>
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="sel1">Select Priority</label>
                                        <select class="form-control" id="sel1" disabled>                        
                       <option ng-model="mod" >{{mod.Priority}}</option>   
                    </select>
                                    </div>
                                    <div class="col-sm-12">
                                        <label for="sel1">Select Concern </label>
                                        <select class="form-control" id="sel1" disabled>                        
                         <option ng-model="mod" >{{mod.Actual_x0020_Concern}}</option>  
                    </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="exampleTextarea">Description</label>
                                    <textarea class="form-control" id="exampleTextarea" rows="3"></textarea>
                                    <div ng-hide="isCommentHide">
                                        <label for="exampleTextarea">Comment</label>
                                        <textarea class="form-control" id="exampleTextarea" rows="3"></textarea>
                                    </div>
                                    <div class="col-sm-6" id="buttons">
                                        <button type="button" class="btn btn-default" ng-hide="isReplyHide">Reply</button>


                                        <button type="button" class="btn btn-default" ng-hide="isResolveHide">Resolve</button>
                                    </div>
                                    <div class="col-sm-6" id="buttons">

                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    </div>

                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div ng-if="NotAuthorised">
                <b>You are not authorised user for this page.</b>
            </div>
            <modal visible="showModal">
                <div class="modal-header">
                    <h3 class="modal-title modalHead" id="modal-title" ng-show="IsView">View Ticket:</h3>
                    <h3 class="modal-title modalHead" id="modal-title" ng-show="IsReply">Reply for Ticket:</h3>
                    <h3 class="modal-title modalHead" id="modal-title" ng-show="IsResolve">Resolve for Ticket:</h3>
                    <button type="button" class="close"  ng-click="cancel(item)">&times;</button>
                               
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div class="col-sm-6">
                            <label for="sel1">Select Department</label>
                            <select class="form-control" id="sel1" disabled> 
                                     <option ng-model="item">{{item.Department.Department}}</option>                   
                                    </select>
                        </div>
                        <div class="col-sm-6">
                            <label for="sel1">Select Priority</label>
                            <select class="form-control" id="sel1" disabled>                        
                       <option ng-model="item" >{{item.Priority}}</option>   
                    </select>
                        </div>
                        <div class="col-sm-6">
                            <label for="sel1">Select Concern </label>
                            <select class="form-control" id="sel1" disabled>                        
                         <option ng-model="item" >{{item.Predefined_x0020_Concern.Predefined_x0020_Concern}}</option>  
                    </select>
                        </div>
                        <div class="col-sm-6">
                            <label for="sel1">   </label>
                            <select class="form-control" id="sel1" style="margin-top: 17px;" disabled>                        
                         <option ng-model="item" >{{item.Actual_x0020_Concern}}</option>  
                    </select>
                        </div>
                        <div class="col-sm-12" style="margin-left:10px;">
                            <label for="exampleTextarea">Description</label>
                            <textarea class="form-control" id="exampleTextarea" rows="3" disabled>{{item.Actual_x0020_Concern}}</textarea>
                        </div>
                        <div class="col-sm-12" ng-show="isCommentHide" style="margin-left:10px;">
                            <label for="exampleTextarea">Comment</label>
                            <textarea class="form-control" id="exampleTextarea" rows="3" ng-model="item.Comments"></textarea>
                        </div>
                         <div  class="col-sm-12">
                        <div class="col-sm-6" id="buttons">
                            <button class="btn btn-blue" type="button" ng-show="isReplyHide" ng-click="ReplyFunction(item)" style="float:right;color: white;">Reply</button>
                            <button class="btn btn-default" type="button" ng-show="isResolveHide" ng-click="ResolveFunction(item)" style="float:right;">Resolve</button>
                        </div>
                        <div class="col-sm-6" id="buttons">
                            <button class="btn btn-danger" type="button" ng-click="cancel(item)">Cancel</button>
                        </div>
                         </div>
                    </div>
                    <div class="col-sm-12" ng-repeat="item in DatalistServiceDeskComments1ById">
                        <div class="col-sm-6"><h5 ng-modal="item">{{item.Comments}} </h5></div>
                        <div class="col-sm-3">
                        <h5 ng-modal="item">{{item.Department}} </h5>
                        <h5 ng-modal="item"  style="color: red;">{{item.Editor.Title}} </h5> 
                        </div>     
                        <div class="col-sm-3">
                        <h5 ng-modal="item">{{item.Predefined_x0020_Concern}} </h5> 
                        <h5 ng-modal="item" style="color: red;"><span ng-bind="item.Modified "></span> </h5> 
                        </div>    
                    </div>            

                </div>
                <!--<button class="btn btn-primary" type="button" ng-click="RejectFunction(item)">OK</button>
                <button class="btn btn-warning" type="button" ng-click="cancel(item)">Cancel</button>-->
            </modal>
        </div>
    </div>
</div>